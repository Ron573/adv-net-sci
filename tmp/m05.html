
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>Hands-on: Clustering &#8212; Advanced Topics in Network Science</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/bootstrap.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />

  
  <link href="../_static/vendor/fontawesome/6.5.2/css/all.min.css?digest=dfe6caa3a7d634c4db9b" rel="stylesheet" />
  <link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-solid-900.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-brands-400.woff2" />
<link rel="preload" as="font" type="font/woff2" crossorigin href="../_static/vendor/fontawesome/6.5.2/webfonts/fa-regular-400.woff2" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css?v=be8a1c11" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/design-style.1e8bd061cd6da7fc9cf755528e8ffc24.min.css?v=0a3b3ea7" />
  
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b" />
  <script src="../_static/vendor/fontawesome/6.5.2/js/all.min.js?digest=dfe6caa3a7d634c4db9b"></script>

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=36754332"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'tmp/m05';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-primary-sidebar-checkbox"/>
  <label class="overlay overlay-primary" for="pst-primary-sidebar-checkbox"></label>
  
  <input type="checkbox"
          class="sidebar-toggle"
          id="pst-secondary-sidebar-checkbox"/>
  <label class="overlay overlay-secondary" for="pst-secondary-sidebar-checkbox"></label>
  
  <div class="search-button__wrapper">
    <div class="search-button__overlay"></div>
    <div class="search-button__search-container">
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         id="search-input"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form></div>
  </div>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <div class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="../home.html">
  
  
  
  
  
    
    
      
    
    
    <img src="../_static/logo.jpg" class="logo__image only-light" alt="Advanced Topics in Network Science - Home"/>
    <script>document.write(`<img src="../_static/logo.jpg" class="logo__image only-dark" alt="Advanced Topics in Network Science - Home"/>`);</script>
  
  
</a></div>
        <div class="sidebar-primary-item">

 <script>
 document.write(`
   <button class="btn search-button-field search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass"></i>
    <span class="search-button__default-text">Search</span>
    <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
   </button>
 `);
 </script></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../home.html">
                    Welcome to SSIE 641 Advanced Topics on Network Science
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading"><span class="caption-text">Intro</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../intro/why-networks.html">Why should we care networks?</a></li>

<li class="toctree-l1"><a class="reference internal" href="../intro/zoo-of-networks.html">Zoo of networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../intro/setup.html">Trouble shooting</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M01: Euler Tour</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m01-euler_tour/what-to-learn.html">Module 1: Euler Tour</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m01-euler_tour/puzzle.html">A puzzle</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m01-euler_tour/euler-path.html">Euler’s solution</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m01-euler_tour/how-to-code-network.html">Compute with networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m01-euler_tour/coding-exercise.html">Exercise</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M02: Small World</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/what-to-learn.html">Module 2: Small-world</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/small-world-experiment.html">Small-world experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/wikirace.html">Wikirace</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/pen-and-paper.html">Why is our social network small world?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/connectedness.html">Walks, Trails, Paths, and Connectedness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/which-tools.html">Toolbox for network analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/compressed-sparse-row.html">Efficient representation for large sparse networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/connectedness-hands-on.html">Computing the Shortest Paths and Connected Components</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/assignment.html">Assignment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m02-small-world/appendix.html">Appendix</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M03: Robustness</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m03-robustness/what-to-learn.html">Module 3: Robustness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m03-robustness/exercise-power-grid.html">Building a cost-effective power grid network</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m03-robustness/minimum-spanning-tree.html">Minimum spanning tree</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m03-robustness/robustness.html">Network Robustness</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m03-robustness/robustness-hands-on.html">Hands-on: Robustness (Random attack)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m03-robustness/percolation.html">Percolation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m03-robustness/appendix.html">Appendix</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M04: Friendship Paradox</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m04-friendship-paradox/what-to-learn.html">Module 4: Friendship Paradox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m04-friendship-paradox/experiment.html">In-class experiment</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m04-friendship-paradox/friendship-paradox.html">Friendship Paradox</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m04-friendship-paradox/vaccination-game.html">Vaccination Game</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m04-friendship-paradox/degree-distribution.html">Degree distribution</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M05: Clustering</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/what-to-learn.html">Module 5: Clustering</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/what-is-community.html">What is community?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/pen-and-paper.html">Pen and Paper</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/pattern-matching.html">Community detection (pattern matching)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/graph-cut.html">Graph cut</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/ratio-normalized-cut.html">Balanced cut</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/modularity.html">Modularity</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/modularity-02.html">Modularity (Cont.)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/stochastic-block-model.html">Stochastic Block Model</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m05-clustering/exercise-clustering.html">Hands-on: Clustering</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M06: Centrality</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m06-centrality/what-to-learn.html">Module 6: Centrality</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m06-centrality/pen-and-paper.html">Pen and paper exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m06-centrality/degree-distance-based-centrality.html">What is centrality?</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m06-centrality/eigencentrality.html">Centralities based on centralities</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m06-centrality/hands-on.html">Computing centrality with Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m06-centrality/assignment.html">Assignment</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M07: Random Walks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m07-random-walks/what-to-learn.html">Module 7: Random Walks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m07-random-walks/amida-kuji.html">Ladder Lottery</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m07-random-walks/random-walks.html">Random Walks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m07-random-walks/pen-and-paper.html">Pen and paper exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m07-random-walks/random-walks-code.html">Random Walks in Python</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m07-random-walks/random-walks-math.html">Characteristics of Random Walks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m07-random-walks/unifying-centrality-and-communities.html">Random walks unify centrality and communities</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M08: Embedding</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m08-embedding/what-to-learn.html">Module 8: Embedding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m08-embedding/pen-and-paper.html">Pen and paper exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m08-embedding/spectral-embedding.html">Spectral Embedding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m08-embedding/word2vec.html">word2vec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m08-embedding/graph-embedding-w-word2vec.html">Graph embedding with word2vec</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m08-embedding/spectral-vs-neural-embedding.html">Spectral vs Neural Embedding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m08-embedding/software.html">Software for Network Embedding</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m08-embedding/appendix.html">Appendix</a></li>
</ul>
<p aria-level="2" class="caption" role="heading"><span class="caption-text">M09: Graph Neural Networks</span></p>
<ul class="nav bd-sidenav">
<li class="toctree-l1"><a class="reference internal" href="../m09-graph-neural-networks/what-to-learn.html">Module 9: Graph Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m09-graph-neural-networks/pen-and-paper.html">Pen and paper exercises</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m09-graph-neural-networks/image-processing.html">Preliminaries: Image Processing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m09-graph-neural-networks/from-image-to-graph.html">From Image to Graph</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m09-graph-neural-networks/graph-convolutional-network.html">Graph Convolutional Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m09-graph-neural-networks/popular-gnn.html">Popular Graph Neural Networks</a></li>
<li class="toctree-l1"><a class="reference internal" href="../m09-graph-neural-networks/appendix.html">Appendix</a></li>
</ul>

    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
  </div>
  
  <div id="rtd-footer-container"></div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-launch-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Launch interactive content">
    <i class="fas fa-rocket"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://mybinder.org/v2/gh/skojaku/adv-net-sci/gh-pages?urlpath=tree/docs/lecture-note/tmp/m05.md" target="_blank"
   class="btn btn-sm dropdown-item"
   title="Launch on Binder"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  
    <img alt="Binder logo" src="../_static/images/logo_binder.svg">
  </span>
<span class="btn__text-container">Binder</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="initThebeSBT()"
  class="btn btn-sm btn-launch-thebe dropdown-item"
  title="Launch Thebe"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-play"></i>
  </span>
<span class="btn__text-container">Live Code</span>
</button>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-source-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Source repositories">
    <i class="fab fa-github"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="https://github.com/skojaku/adv-net-sci" target="_blank"
   class="btn btn-sm btn-source-repository-button dropdown-item"
   title="Source repository"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="btn__text-container">Repository</span>
</a>
</li>
      
      
      
      
      <li><a href="https://github.com/skojaku/adv-net-sci/issues/new?title=Issue%20on%20page%20%2Ftmp/m05.html&body=Your%20issue%20content%20here." target="_blank"
   class="btn btn-sm btn-source-issues-button dropdown-item"
   title="Open an issue"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="btn__text-container">Open issue</span>
</a>
</li>
      
  </ul>
</div>






<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/tmp/m05.ipynb" target="_blank"
   class="btn btn-sm btn-download-notebook-button dropdown-item"
   title="Download notebook file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-code"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li><a href="../_sources/tmp/m05.md" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.md</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<script>
document.write(`
  <button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button" title="light/dark" aria-label="light/dark" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="theme-switch fa-solid fa-sun fa-lg" data-mode="light"></i>
    <i class="theme-switch fa-solid fa-moon fa-lg" data-mode="dark"></i>
    <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"></i>
  </button>
`);
</script>


<script>
document.write(`
  <button class="btn btn-sm pst-navbar-icon search-button search-button__button" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
  </button>
`);
</script>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1>Hands-on: Clustering</h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Hands-on: Clustering</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modularity-maximization">Modularity maximization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-01">Exercise 01 🏋️‍♀️💪🧠</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stochstic-block-model">Stochstic Block Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-02">Exercise 02 🏋️‍♀️💪🧠</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modularity-demo">Modularity Demo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitation-of-modularity">Limitation of Modularity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resolution-limit">Resolution limit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spurious-communities">Spurious communities</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#so-should-we-avoid-modularity">So should we avoid modularity?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-full-modularity-formula-is-on-the-next-page-jupytext-formats-md-myst-text-representation-extension-md-format-name-myst-kernelspec-display-name-python-3-language-python-name-python3">The full modularity formula is on the next page 😉.—
jupytext:
formats: md:myst
text_representation:
extension: .md
format_name: myst
kernelspec:
display_name: Python 3
language: python
name: python3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#community-detection-pattern-matching">Community detection (pattern matching)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pen-and-paper">Pen and Paper</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pen-and-paper-exercise">✍️ <span class="xref myst">Pen and Paper Exercise</span> 🚢</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jupytext-formats-md-myst-text-representation-extension-md-format-name-myst-kernelspec-display-name-python-3-language-python-name-python3">jupytext:
formats: md:myst
text_representation:
extension: .md
format_name: myst
kernelspec:
display_name: Python 3
language: python
name: python3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#balanced-cut">Balanced cut</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ratio-cut">Ratio Cut</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#normalized-cut">Normalized cut</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cut-into-more-than-two-communities">Cut into more than two communities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#algorithms-to-find-the-best-cut">Algorithms to find the best cut</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#issue-of-ratio-cut-and-normalized-cut">Issue of Ratio cut and Normalized cut</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#characterizing-network-structures-with-the-sbm">Characterizing network structures with the SBM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-networks-with-sbm">Generating networks with SBM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detecting-communities-with-sbm">Detecting communities with SBM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#module-5-clustering">Module 5: Clustering</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-to-learn-in-this-module">What to learn in this module</a></li>
</ul>
</li>
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <a target="_blank" href="https://colab.research.google.com/github/skojaku/adv-net-sci/blob/main/notebooks/exercise-m05-clustering.ipynb">
  <img src="https://colab.research.google.com/assets/colab-badge.svg" alt="Open In Colab"/>
</a>
<section class="tex2jax_ignore mathjax_ignore" id="hands-on-clustering">
<h1>Hands-on: Clustering<a class="headerlink" href="#hands-on-clustering" title="Link to this heading">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># If you are using Google Colab, uncomment the following line to install igraph</span>
<span class="c1"># !sudo apt install libcairo2-dev pkg-config python3-dev</span>
<span class="c1"># !pip install pycairo cairocffi</span>
<span class="c1"># !pip install igraph</span>
</pre></div>
</div>
</div>
</div>
<section id="modularity-maximization">
<h2>Modularity maximization<a class="headerlink" href="#modularity-maximization" title="Link to this heading">#</a></h2>
<p>Let us showcase how to use <code class="docutils literal notranslate"><span class="pre">igraph</span></code> to detect communities with modularity. We will use the Karate Club Network as an example.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">igraph</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Famous</span><span class="p">(</span><span class="s2">&quot;Zachary&quot;</span><span class="p">)</span>
<span class="n">igraph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">vertex_size</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/2b39b00f66ad3c6bb6a7d9dd4fb008bb11ed82fdcfeddf90ae71868b0b0e4af6.svg" src="../_images/2b39b00f66ad3c6bb6a7d9dd4fb008bb11ed82fdcfeddf90ae71868b0b0e4af6.svg" /></div>
</div>
<p>When it comes to maximizing modularity, there are a variety of algorithms to choose from.
Two of the most popular ones are the <code class="docutils literal notranslate"><span class="pre">Louvain</span></code> and <code class="docutils literal notranslate"><span class="pre">Leiden</span></code> algorithms, both of which are implemented in <code class="docutils literal notranslate"><span class="pre">igraph</span></code>. The Louvain algorithm has been around for quite some time and is a classic choice, while the Leiden algorithm is a newer bee that often yields better accuracy. For our example, we’ll be using the <code class="docutils literal notranslate"><span class="pre">Leiden</span></code> algorithm, and I think you’ll find it really effective!</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">communities</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">community_leiden</span><span class="p">(</span><span class="n">resolution</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">objective_function</span><span class="o">=</span> <span class="s2">&quot;modularity&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>What is <code class="docutils literal notranslate"><span class="pre">resolution</span></code>? It is a parameter that helps us tackle the resolution limit of the modularity maximization algorithm <a class="footnote-reference brackets" href="#footcite-fortunato2007resolution" id="id1" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>!
In simple terms, when we use the resolution parameter <span class="math notranslate nohighlight">\(\rho\)</span>, the modularity formula can be rewritten as
follow:</p>
<div class="math notranslate nohighlight">
\[
Q(M) = \frac{1}{2m} \sum_{i=1}^n \sum_{j=1}^n \left(A_{ij} - \rho \frac{k_i k_j}{2m}\right) \delta(c_i, c_j)
\]</div>
<p>Here, the parameter <span class="math notranslate nohighlight">\(\rho\)</span> plays a crucial role in balancing the positive and negative parts of the equation.
The resolution limit comes into play because of the diminishing effect of the negative term as the number of edges <span class="math notranslate nohighlight">\(m\)</span> increases.
The parameter <span class="math notranslate nohighlight">\(\rho\)</span> can adjust this balance and allow us to circumvent the resolution limit.</p>
<p>What is <code class="docutils literal notranslate"><span class="pre">communities</span></code>? This is a list of communities, where each community is represented by a list of nodes by their indices.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">communities</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Clustering with 34 elements and 4 clusters
[0] 0, 1, 2, 3, 7, 11, 12, 13, 17, 19, 21
[1] 4, 5, 6, 10, 16
[2] 8, 9, 14, 15, 18, 20, 22, 26, 29, 30, 32, 33
[3] 23, 24, 25, 27, 28, 31
</pre></div>
</div>
</div>
</div>
<p>Let us visualize the communities by coloring the nodes in the graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">community_membership</span> <span class="o">=</span> <span class="n">communities</span><span class="o">.</span><span class="n">membership</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span><span class="o">.</span><span class="n">as_hex</span><span class="p">()</span>
<span class="n">igraph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">vertex_color</span><span class="o">=</span><span class="p">[</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">community_membership</span><span class="p">])</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7305143e3b442d1ab68859d1bc680a9bfcf7be0348dc9530c8dd435efd5903b4.svg" src="../_images/7305143e3b442d1ab68859d1bc680a9bfcf7be0348dc9530c8dd435efd5903b4.svg" /></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">community_membership</span></code>: This is a list of community membership for each node.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">palette</span></code>: This is a list of colors to use for the communities.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">igraph.plot(g,</span> <span class="pre">vertex_color=[palette[i]</span> <span class="pre">for</span> <span class="pre">i</span> <span class="pre">in</span> <span class="pre">community_membership])</span></code>: This plots the graph ‘g’ with nodes colored by their community.</p></li>
</ul>
<section id="exercise-01">
<h3>Exercise 01 🏋️‍♀️💪🧠<a class="headerlink" href="#exercise-01" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Select a network of your choice from <a class="reference external" href="https://networks.skewed.de/">Netzschleuder</a>. For convenience, choose a network of nodes less than 5000.</p></li>
<li><p>Download the csv version of the data by clicking something like “3KiB” under <code class="docutils literal notranslate"><span class="pre">csv</span></code> column.</p></li>
<li><p>Unzip the file and find “edges.csv”, open it with a text editor to familiarize yourself with the format.</p></li>
<li><p>Load the data using <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.</p></li>
<li><p>Get the source and target nodes from the data to create an edge list.</p></li>
<li><p>Construct a graph from the edge list, either using <code class="docutils literal notranslate"><span class="pre">igraph</span></code> or <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.</p></li>
<li><p>Find communities by maximizing the modularity and visualize them.</p></li>
<li><p>Try at least three different values of the resolution parameter and observe how the community structure changes.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Your code here</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="stochstic-block-model">
<h2>Stochstic Block Model<a class="headerlink" href="#stochstic-block-model" title="Link to this heading">#</a></h2>
<p>Let us turn the SBM as our community detection tool using <a class="reference external" href="https://graph-tool.skewed.de/">graph-tool</a>. This is a powerful library for network analysis, with a focus on the stochastic block model.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#</span>
<span class="c1"># Uncomment the following code if you are using Google Colab</span>
<span class="c1">#</span>
<span class="c1">#!wget https://downloads.skewed.de/skewed-keyring/skewed-keyring_1.0_all_$(lsb_release -s -c).deb</span>
<span class="c1">#!dpkg -i skewed-keyring_1.0_all_$(lsb_release -s -c).deb</span>
<span class="c1">#!echo &quot;deb [signed-by=/usr/share/keyrings/skewed-keyring.gpg] https://downloads.skewed.de/apt $(lsb_release -s -c) main&quot; &gt; /etc/apt/sources.list.d/skewed.list</span>
<span class="c1">#!apt-get update</span>
<span class="c1">#!apt-get install python3-graph-tool python3-matplotlib python3-cairo</span>
<span class="c1">#!apt purge python3-cairo</span>
<span class="c1">#!apt install libcairo2-dev pkg-config python3-dev</span>
<span class="c1">#!pip install --force-reinstall pycairo</span>
<span class="c1">#!pip install zstandard</span>
</pre></div>
</div>
</div>
</div>
<p>We will identify the communities using the stochastic block model as follows.
First, we will convert the graph object in igraph to that in graph-tool.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">graph_tool.all</span>  <span class="k">as</span> <span class="nn">gt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">igraph</span>

<span class="c1"># igraph object</span>
<span class="n">g</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Famous</span><span class="p">(</span><span class="s2">&quot;Zachary&quot;</span><span class="p">)</span>

<span class="c1"># Set random seed for reproducibility</span>
<span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Convert the graph object in igraph to that in graph-tool</span>
<span class="n">edges</span> <span class="o">=</span> <span class="n">g</span><span class="o">.</span><span class="n">get_edgelist</span><span class="p">()</span>
<span class="n">r</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="nb">zip</span><span class="p">(</span><span class="o">*</span><span class="n">edges</span><span class="p">)</span>
<span class="n">g_gt</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">Graph</span><span class="p">(</span><span class="n">directed</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">g_gt</span><span class="o">.</span><span class="n">add_edge_list</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">vstack</span><span class="p">([</span><span class="n">r</span><span class="p">,</span> <span class="n">c</span><span class="p">])</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then, we will fit the stochastic block model to the graph.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fit the stochastic block model</span>
<span class="n">state</span> <span class="o">=</span> <span class="n">gt</span><span class="o">.</span><span class="n">minimize_blockmodel_dl</span><span class="p">(</span>
     <span class="n">g_gt</span><span class="p">,</span>
     <span class="n">state_args</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;deg_corr&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span> <span class="s2">&quot;B_min&quot;</span><span class="p">:</span><span class="mi">2</span><span class="p">,</span> <span class="s2">&quot;B_max&quot;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span>
<span class="p">)</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">state</span><span class="o">.</span><span class="n">get_blocks</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/Users/skojaku-admin/miniforge3/envs/advnetsci/lib/python3.11/site-packages/graph_tool/inference/blockmodel.py:390: UserWarning: unrecognized keyword arguments: [&#39;B_min&#39;, &#39;B_max&#39;]
  warnings.warn(&quot;unrecognized keyword arguments: &quot; +
</pre></div>
</div>
</div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">B_min</span></code> and <code class="docutils literal notranslate"><span class="pre">B_max</span></code> are the minimum and maximum number of communities to consider.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">deg_corr</span></code> is a boolean flag to switch to the degree-corrected SBM <a class="footnote-reference brackets" href="#footcite-karrer2011stochastic" id="id2" role="doc-noteref"><span class="fn-bracket">[</span>2<span class="fn-bracket">]</span></a>.</p></li>
</ul>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Here’s a fun fact: the likelihood maximization on its own can’t figure out how many communities there should be. But <code class="docutils literal notranslate"><span class="pre">graph-tool</span></code> has a clever trick to circumvent this limitation.
<code class="docutils literal notranslate"><span class="pre">graph-tool</span></code> actually fits multiple SBMs, each with a different number of communities. Then, it picks the most plausible one based on a model selection criterion.</p>
</div>
<p>Let’s visualize the communities to see what we got.</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert the block assignments to a list</span>
<span class="n">community_membership</span> <span class="o">=</span> <span class="n">b</span><span class="o">.</span><span class="n">get_array</span><span class="p">()</span>

<span class="c1"># The community labels may consist of non-consecutive integers, e.g., 10, 8, 1, 4, ...</span>
<span class="c1"># So we reassign the community labels to be 0, 1, 2, ...</span>
<span class="n">community_membership</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">community_membership</span><span class="p">,</span> <span class="n">return_inverse</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="mi">1</span><span class="p">]</span>
<span class="n">community_membership</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0,
       0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Create a color palette</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span><span class="o">.</span><span class="n">as_hex</span><span class="p">()</span>
<span class="c1"># Plot the graph with nodes colored by their community</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">igraph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">g</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">vertex_color</span><span class="o">=</span><span class="p">[</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">community_membership</span><span class="p">],</span>
<span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/10fc013a527eeafa518d33b0de788dcbc193cf7b8ee5abb3e7b80db1d71cfc87.png" src="../_images/10fc013a527eeafa518d33b0de788dcbc193cf7b8ee5abb3e7b80db1d71cfc87.png" />
</div>
</div>
<p>What we’re seeing here isn’t a failure at all. In fact, it’s the best partition according to our stochastic block model. The model has discovered something called a <strong>core-periphery structure</strong> <a class="footnote-reference brackets" href="#footcite-borgatti2000models" id="id3" role="doc-noteref"><span class="fn-bracket">[</span>3<span class="fn-bracket">]</span></a>. Let me break that down:</p>
<ul class="simple">
<li><p>Think of a major international airport (the core) and smaller regional airports (the periphery).</p></li>
<li><p>Major international airports have many flights connecting to each other (densely connected).</p></li>
<li><p>Smaller regional airports have fewer connections among themselves (sparsely connected).</p></li>
<li><p>Many regional airports have flights to major hubs (periphery connected to the core).</p></li>
</ul>
<p>That’s exactly what our model found in this network.</p>
<p>If we look at the adjacency matrix, we would see something that looks like an upside-down “L”. This shape is like a signature for core-periphery structures.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert igraph Graph to adjacency matrix</span>
<span class="n">A</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">g</span><span class="o">.</span><span class="n">get_adjacency</span><span class="p">()</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>

<span class="c1"># Sort nodes based on their community (core first, then periphery)</span>
<span class="n">sorted_indices</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argsort</span><span class="p">(</span><span class="n">community_membership</span><span class="p">)</span>
<span class="n">A_sorted</span> <span class="o">=</span> <span class="n">A</span><span class="p">[</span><span class="n">sorted_indices</span><span class="p">][:,</span> <span class="n">sorted_indices</span><span class="p">]</span>

<span class="c1"># Plot the sorted adjacency matrix</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">imshow</span><span class="p">(</span><span class="n">A_sorted</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;binary&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Sorted Adjacency Matrix: Core-Periphery Structure&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Node Index (sorted)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Node Index (sorted)&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cac7f819528feb71651313c1759aa372d5161381fa3dced96b99b54bcf0994c3.png" src="../_images/cac7f819528feb71651313c1759aa372d5161381fa3dced96b99b54bcf0994c3.png" />
</div>
</div>
<section id="exercise-02">
<h3>Exercise 02 🏋️‍♀️💪🧠<a class="headerlink" href="#exercise-02" title="Link to this heading">#</a></h3>
<ol class="arabic simple">
<li><p>Select a network of your choice from <a class="reference external" href="https://networks.skewed.de/">Netzschleuder</a>. For convenience, choose a network of nodes less than 5000.</p></li>
<li><p>Download the csv version of the data by clicking something like “3KiB” under <code class="docutils literal notranslate"><span class="pre">csv</span></code> column.</p></li>
<li><p>Unzip the file and find “edges.csv”, open it with a text editor to familiarize yourself with the format.</p></li>
<li><p>Load the data using <code class="docutils literal notranslate"><span class="pre">pandas</span></code>.</p></li>
<li><p>Get the source and target nodes from the data to create an edge list.</p></li>
<li><p>Construct a graph from the edge list, either using <code class="docutils literal notranslate"><span class="pre">igraph</span></code> or <code class="docutils literal notranslate"><span class="pre">scipy</span></code>.</p></li>
<li><p>Find communities by fitting the stochastic block model and visualize them.</p></li>
<li><p>Try <code class="docutils literal notranslate"><span class="pre">deg_corr=True</span></code> and compare the results with those from <code class="docutils literal notranslate"><span class="pre">deg_corr=False</span></code>.</p></li>
</ol>
<div class="docutils container" id="id4">
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-fortunato2007resolution" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id1">1</a>,<a role="doc-backlink" href="#id5">2</a>)</span>
<p>Santo Fortunato and Marc Barthelemy. Resolution limit in community detection. <em>Proceedings of the national academy of sciences</em>, 104(1):36–41, 2007.</p>
</aside>
<aside class="footnote brackets" id="footcite-karrer2011stochastic" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id2">2</a><span class="fn-bracket">]</span></span>
<p>Brian Karrer and Mark EJ Newman. Stochastic blockmodels and community structure in networks. <em>Physical Review E—Statistical, Nonlinear, and Soft Matter Physics</em>, 83(1):016107, 2011.</p>
</aside>
<aside class="footnote brackets" id="footcite-borgatti2000models" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id3">3</a><span class="fn-bracket">]</span></span>
<p>Stephen P Borgatti and Martin G Everett. Models of core/periphery structures. <em>Social networks</em>, 21(4):375–395, 2000.</p>
</aside>
</aside>
</div>
</section>
</section>
<section id="modularity-demo">
<h2>Modularity Demo<a class="headerlink" href="#modularity-demo" title="Link to this heading">#</a></h2>
<p>Let’s learn how the modularity works by playing with a community detection game!</p>
<div class="tip admonition">
<p class="admonition-title">Exercise 1</p>
<p>Find communities by maximizing the modularity. <a href='https://skojaku.github.io/adv-net-sci/vis/community-detection/index.html?scoreType=modularity&numCommunities=2&randomness=1&dataFile=two-cliques.json'>Modularity maximization (two communities) 🎮</a></p>
</div>
<p>One of the good things about modularity is that it can figure out how many communities there should be all by itself! 🕵️‍♀️ Let’s have some fun with this idea. We’re going to play the same game again, but this time, we’ll start with a different number of communities. See how the modularity score changes as we move things around.</p>
<div class="tip admonition">
<p class="admonition-title">Exercise 2</p>
<p>Find communities by maximizing the modularity. <a href='https://skojaku.github.io/adv-net-sci/vis/community-detection/index.html?scoreType=modularity&numCommunities=4&randomness=1&dataFile=two-cliques.json'>Modularity maximization (four communities) 🎮</a></p>
</div>
<p>Now, let’s take our modularity maximization for a real-world example! 🥋 We’re going to use the famous karate club network. This network represents friendships between members of a university karate club. It’s a classic in the world of network science, and it’s perfect for seeing how modularity works in practice.</p>
<div class="tip admonition">
<p class="admonition-title">Exercise 3</p>
<p>Find communities by maximizing the modularity. <a href='https://skojaku.github.io/adv-net-sci/vis/community-detection/index.html?scoreType=modularity&numCommunities=4&randomness=0.25&dataFile=net_karate.json'>Modularity maximization (four communities) 🎮</a></p>
</div>
</section>
<section id="limitation-of-modularity">
<h2>Limitation of Modularity<a class="headerlink" href="#limitation-of-modularity" title="Link to this heading">#</a></h2>
<p>Like many other community detection methods, modularity is not a silver bullet. Thanks to extensive research, we know many limitations of modularity. Let’s take a look at a few of them.</p>
<section id="resolution-limit">
<h3>Resolution limit<a class="headerlink" href="#resolution-limit" title="Link to this heading">#</a></h3>
<p>The modularity finds two cliques connected by a single edge as two separate communities.
But what if we add another community to this network?
Our intuition tells us that, because communities are <em>local</em> structure, the two cliques should remain separated by the modularity. But is this the case?</p>
<div class="tip admonition">
<p class="admonition-title">Exercise 4</p>
<p>Find communities by maximizing the modularity. <a href='https://skojaku.github.io/adv-net-sci/vis/community-detection/index.html?scoreType=modularity&numCommunities=3&randomness=0.9&dataFile=two-cliques-big-clique.json'>Modularity maximization (four communities) 🎮</a></p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Click here to see the solution<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The best modularity score actually comes from merging our two cliques into one big community. This behavior is what we call the <strong>Resolution limit</strong> <a class="footnote-reference brackets" href="#footcite-fortunato2007resolution" id="id5" role="doc-noteref"><span class="fn-bracket">[</span>1<span class="fn-bracket">]</span></a>. Modularity can’t quite make out communities that are smaller than a certain size!</p>
<p class="sd-card-text">Think of it like this: modularity is trying to see the big picture, but it misses the little details. In network terms, the number of edges <span class="math notranslate nohighlight">\(m_c\)</span> in a community <span class="math notranslate nohighlight">\(c\)</span> has to be bigger than a certain size. This size is related to the total number of edges <span class="math notranslate nohighlight">\(m\)</span> in the whole network. We write this mathematically as <span class="math notranslate nohighlight">\({\cal O}(m)\)</span>.</p>
</div>
</details></div>
</section>
<section id="spurious-communities">
<h3>Spurious communities<a class="headerlink" href="#spurious-communities" title="Link to this heading">#</a></h3>
<p>What if the network does not have any communities at all? Does the modularity find no communities? To find out, let’s run the modularity on a random network, where each pair of nodes is connected randomly with the same probability.</p>
<div class="tip admonition">
<p class="admonition-title">Exercise 5</p>
<p>Find communities by maximizing the modularity. <a href='https://skojaku.github.io/adv-net-sci/vis/community-detection/index.html?scoreType=modularity&numCommunities=3&randomness=0.8&dataFile=random-net.json'>Modularity maximization (four communities) 🎮</a></p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Click here to see the solution<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">Surprise, surprise! 😮 Modularity finds communities even in our random network, and with a very high score too! It’s like finding shapes in clouds - sometimes our brains (or algorithms) see patterns where there aren’t any.</p>
<p class="sd-card-text">The wild thing is that the modularity score for this random network is even higher than what we saw for our network with two clear cliques!</p>
<p class="sd-card-text">This teaches us two important lessons:</p>
<ol class="arabic simple">
<li><p class="sd-card-text">We can’t compare modularity scores between different networks. It’s like comparing apples and oranges! 🍎🍊</p></li>
<li><p class="sd-card-text">A high modularity score doesn’t always mean we’ve found communities.</p></li>
</ol>
<p class="sd-card-text">Interested readers can read more about this in <a class="reference external" href="https://twitter.com/tiagopeixoto/status/1466352013856358400">this tweet by Tiago Peixoto</a> and the discussion <a class="reference external" href="https://reticular.hypotheses.org/1924">here</a>.</p>
<blockquote class="twitter-tweet" style="max-width: 550px;"><p lang="en" dir="ltr">Modularity maximization is not a reliable method to find communities in networks. Here&#39;s a simple example showing why:<br><br>1. Generate an Erdős-Rényi random graph with N nodes and average degree &lt;k&gt;.<br><br>2. Find the maximum modularity partition. <a href="https://t.co/MTt5DdFXSX">pic.twitter.com/MTt5DdFXSX</a></p>&mdash; Tiago Peixoto (@tiagopeixoto) <a href="https://twitter.com/tiagopeixoto/status/1466352013856358400?ref_src=twsrc%5Etfw">December 2, 2021</a></blockquote> <script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script>
</div>
</details></div>
</section>
</section>
<section id="so-should-we-avoid-modularity">
<h2>So should we avoid modularity?<a class="headerlink" href="#so-should-we-avoid-modularity" title="Link to this heading">#</a></h2>
<p>The simple answer is no. Modularity is still a powerful tool for finding communities in networks. Like any other method, it has its limitations. And knowing these limitations is crucial for using it effectively. There is “free lunch” in community detection <a class="footnote-reference brackets" href="#footcite-peel2017ground" id="id6" role="doc-noteref"><span class="fn-bracket">[</span>4<span class="fn-bracket">]</span></a>.</p>
<p>When these implicit assumptions are met, modularity is in fact a very powerful method for community detection. For example, it is in fact an “optimal” method for a certain class of networks <a class="footnote-reference brackets" href="#footcite-nadakuditi2012graph" id="id7" role="doc-noteref"><span class="fn-bracket">[</span>5<span class="fn-bracket">]</span></a>.</p>
<p>So, keep modularity in your toolbox. Just remember to use it wisely!</p>
<div class="docutils container" id="id8">
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-peel2017ground" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id6">4</a><span class="fn-bracket">]</span></span>
<p>Leto Peel, Daniel B Larremore, and Aaron Clauset. The ground truth about metadata and community detection in networks. <em>Science advances</em>, 3(5):e1602548, 2017.</p>
</aside>
<aside class="footnote brackets" id="footcite-nadakuditi2012graph" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id7">5</a><span class="fn-bracket">]</span></span>
<p>Raj Rao Nadakuditi and Mark EJ Newman. Graph spectra and the detectability of community structure in networks. <em>Physical review letters</em>, 108(18):188701, 2012.</p>
</aside>
</aside>
</div>
<div class="tip admonition">
<p class="admonition-title">Exercise</p>
<p>What is the probability of color matches for the random version? Derive the probability by using <span class="math notranslate nohighlight">\(\sum, M, \delta(c_i, c_j), k_i,k_j\)</span>.</p>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Hint<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<ol class="arabic simple">
<li><p class="sd-card-text">Imagine a big bag full of colorful balls, but this time without any strings. 🔴🟢🔵🟡</p></li>
<li><p class="sd-card-text">Now, think about picking one ball out of the bag. What are the chances of picking a specific color?</p></li>
<li><p class="sd-card-text">Then, put that ball back and pick another one. What are the odds this second ball matches the color of the first one?</p></li>
</ol>
</div>
</details></div>
</section>
<section id="the-full-modularity-formula-is-on-the-next-page-jupytext-formats-md-myst-text-representation-extension-md-format-name-myst-kernelspec-display-name-python-3-language-python-name-python3">
<h2>The full modularity formula is on the next page 😉.—
jupytext:
formats: md:myst
text_representation:
extension: .md
format_name: myst
kernelspec:
display_name: Python 3
language: python
name: python3<a class="headerlink" href="#the-full-modularity-formula-is-on-the-next-page-jupytext-formats-md-myst-text-representation-extension-md-format-name-myst-kernelspec-display-name-python-3-language-python-name-python3" title="Link to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="community-detection-pattern-matching">
<h1>Community detection (pattern matching)<a class="headerlink" href="#community-detection-pattern-matching" title="Link to this heading">#</a></h1>
<p>Community detection is an abstract unsupervised problem. It is abstract because there is no clear-cut definition or ground truth to compare against. The concept of a community in a network is subjective and highly context-dependent.</p>
<p>A classical approach to community detection is based on <em>pattern matching</em>.
Namely, we first explicitly define a community by a specific connectivity pattern of its members. Then, we search for these communities in the network.</p>
<figure class="align-default" id="clique">
<a class="reference internal image-reference" href="https://pythonhosted.org/trustedanalytics/R_images/k-clique_201508281155.png"><img alt="Clique graph" src="https://pythonhosted.org/trustedanalytics/R_images/k-clique_201508281155.png" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text">Cliques of different sizes. Taken from <a class="reference external" href="https://pythonhosted.org/trustedanalytics/python_api/graphs/graph-/kclique_percolation.html">https://pythonhosted.org/trustedanalytics/python_api/graphs/graph-/kclique_percolation.html</a></span><a class="headerlink" href="#clique" title="Link to this image">#</a></p>
</figcaption>
</figure>
<p>Perhaps, the strictest definition of a community is a <em>clique</em>: a group of nodes all connected to each other. Examples include triangles (3-node cliques) and fully-connected squares (4-node cliques).
However, cliques are often too rigid for real-world networks. In social networks, for instance, large groups of friends rarely have every member connected to every other, yet we want to accept such “in-perfect” social circles as communities.
This leads to the idea of relaxed versions of cliques, called <strong>pseudo-cliques</strong>.</p>
<p>Pseudo-cliques are defined by relaxing at least one of the following three dimensions of strictness:</p>
<ol class="arabic simple">
<li><p>Degree: Not all nodes need to connect to every other node.</p>
<ul class="simple">
<li><p><strong><span class="math notranslate nohighlight">\(k\)</span>-plex</strong>: each node connects to all but <span class="math notranslate nohighlight">\(k\)</span> others in the group <a class="footnote-reference brackets" href="#footcite-seidman1978graph" id="id9" role="doc-noteref"><span class="fn-bracket">[</span>6<span class="fn-bracket">]</span></a>.</p></li>
<li><p><strong><span class="math notranslate nohighlight">\(k\)</span>-core</strong>: each node connects to <span class="math notranslate nohighlight">\(k\)</span> others in the group <a class="footnote-reference brackets" href="#footcite-seidman1983network" id="id10" role="doc-noteref"><span class="fn-bracket">[</span>7<span class="fn-bracket">]</span></a>.</p></li>
</ul>
</li>
<li><p>Density: The overall connection density can be lower.</p>
<ul class="simple">
<li><p><strong><span class="math notranslate nohighlight">\(\rho\)</span>-dense subgraphs</strong>, with a minimum edge density of <span class="math notranslate nohighlight">\(\rho\)</span> <a class="footnote-reference brackets" href="#footcite-goldberg1984finding" id="id11" role="doc-noteref"><span class="fn-bracket">[</span>8<span class="fn-bracket">]</span></a>.</p></li>
</ul>
</li>
<li><p>Distance: Nodes can be further apart.</p>
<ul class="simple">
<li><p><strong><span class="math notranslate nohighlight">\(n\)</span>-clique</strong>, where all nodes are within n steps of each other <a class="footnote-reference brackets" href="#footcite-luce1950connectivity" id="id12" role="doc-noteref"><span class="fn-bracket">[</span>9<span class="fn-bracket">]</span></a>.</p></li>
</ul>
</li>
<li><p>Combination of the above:</p>
<ul class="simple">
<li><p><strong>n-clan</strong> and <strong>n-club</strong> <a class="footnote-reference brackets" href="#footcite-mokken1979cliques" id="id13" role="doc-noteref"><span class="fn-bracket">[</span>10<span class="fn-bracket">]</span></a></p></li>
<li><p><strong><span class="math notranslate nohighlight">\(k\)</span>-truss</strong>, a maximal subgraph where all edges participate in at least <span class="math notranslate nohighlight">\(k-2\)</span> triangles <a class="footnote-reference brackets" href="#footcite-saito2008extracting" id="id14" role="doc-noteref"><span class="fn-bracket">[</span>11<span class="fn-bracket">]</span></a><a class="footnote-reference brackets" href="#footcite-cohen2009graph" id="id15" role="doc-noteref"><span class="fn-bracket">[</span>12<span class="fn-bracket">]</span></a><a class="footnote-reference brackets" href="#footcite-wang2010triangulation" id="id16" role="doc-noteref"><span class="fn-bracket">[</span>13<span class="fn-bracket">]</span></a>.</p></li>
<li><p><strong><span class="math notranslate nohighlight">\(\rho\)</span>-dense core</strong>, a subgraph with minimum conductance <span class="math notranslate nohighlight">\(\rho\)</span> <a class="footnote-reference brackets" href="#footcite-koujaku2016dense" id="id17" role="doc-noteref"><span class="fn-bracket">[</span>14<span class="fn-bracket">]</span></a>.</p></li>
</ul>
</li>
</ol>
<figure class="align-default" id="clique-pattern">
<a class="reference internal image-reference" href="https://ars.els-cdn.com/content/image/1-s2.0-S0378873315000520-gr1.jpg"><img alt="Pseudo-clique patterns" src="https://ars.els-cdn.com/content/image/1-s2.0-S0378873315000520-gr1.jpg" style="width: 80%;" /></a>
<figcaption>
<p><span class="caption-text">Illustation of different pseudo cliques. Taken from <a class="footnote-reference brackets" href="#footcite-koujaku2016dense" id="id18" role="doc-noteref"><span class="fn-bracket">[</span>14<span class="fn-bracket">]</span></a>.</span><a class="headerlink" href="#clique-pattern" title="Link to this image">#</a></p>
</figcaption>
</figure>
<div class="docutils container" id="id19">
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-seidman1978graph" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id9">6</a><span class="fn-bracket">]</span></span>
<p>Stephen B Seidman and Brian L Foster. A graph-theoretic generalization of the clique concept. <em>Journal of Mathematical sociology</em>, 6(1):139–154, 1978.</p>
</aside>
<aside class="footnote brackets" id="footcite-seidman1983network" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id10">7</a><span class="fn-bracket">]</span></span>
<p>Stephen B Seidman. Network structure and minimum degree. <em>Social networks</em>, 5(3):269–287, 1983.</p>
</aside>
<aside class="footnote brackets" id="footcite-goldberg1984finding" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id11">8</a><span class="fn-bracket">]</span></span>
<p>Andrew V Goldberg. Finding a maximum density subgraph. <em>Technical report</em>, 1984.</p>
</aside>
<aside class="footnote brackets" id="footcite-luce1950connectivity" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id12">9</a><span class="fn-bracket">]</span></span>
<p>R Duncan Luce. Connectivity and generalized cliques in sociometric group structure. <em>Psychometrika</em>, 15(2):169–190, 1950.</p>
</aside>
<aside class="footnote brackets" id="footcite-mokken1979cliques" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id13">10</a><span class="fn-bracket">]</span></span>
<p>Robert J Mokken and others. Cliques, clubs and clans. <em>Quality &amp; Quantity</em>, 13(2):161–173, 1979.</p>
</aside>
<aside class="footnote brackets" id="footcite-saito2008extracting" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id14">11</a><span class="fn-bracket">]</span></span>
<p>Kazumi Saito, Takeshi Yamada, and Kazuhiro Kazama. Extracting communities from complex networks by the k-dense method. <em>IEICE Transactions on Fundamentals of Electronics, Communications and Computer Sciences</em>, 91(11):3304–3311, 2008.</p>
</aside>
<aside class="footnote brackets" id="footcite-cohen2009graph" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id15">12</a><span class="fn-bracket">]</span></span>
<p>Jonathan Cohen. Graph twiddling in a mapreduce world. <em>Computing in Science &amp; Engineering</em>, 11(4):29–41, 2009.</p>
</aside>
<aside class="footnote brackets" id="footcite-wang2010triangulation" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id16">13</a><span class="fn-bracket">]</span></span>
<p>Nan Wang, Jingbo Zhang, Kian-Lee Tan, and Anthony KH Tung. On triangulation-based dense neighborhood graph discovery. <em>Proceedings of the VLDB Endowment</em>, 4(2):58–68, 2010.</p>
</aside>
<aside class="footnote brackets" id="footcite-koujaku2016dense" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span>14<span class="fn-bracket">]</span></span>
<span class="backrefs">(<a role="doc-backlink" href="#id17">1</a>,<a role="doc-backlink" href="#id18">2</a>)</span>
<p>Sadamori Koujaku, Ichigaku Takigawa, Mineichi Kudo, and Hideyuki Imai. Dense core model for cohesive subgraph discovery. <em>Social Networks</em>, 44:143–152, 2016.</p>
</aside>
</aside>
</div>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="pen-and-paper">
<h1>Pen and Paper<a class="headerlink" href="#pen-and-paper" title="Link to this heading">#</a></h1>
<section id="pen-and-paper-exercise">
<h2>✍️ <a class="reference internal" href="#./pen-and-paper/exercise.pdf"><span class="xref myst">Pen and Paper Exercise</span></a> 🚢<a class="headerlink" href="#pen-and-paper-exercise" title="Link to this heading">#</a></h2>
</section>
<section id="jupytext-formats-md-myst-text-representation-extension-md-format-name-myst-kernelspec-display-name-python-3-language-python-name-python3">
<h2>jupytext:
formats: md:myst
text_representation:
extension: .md
format_name: myst
kernelspec:
display_name: Python 3
language: python
name: python3<a class="headerlink" href="#jupytext-formats-md-myst-text-representation-extension-md-format-name-myst-kernelspec-display-name-python-3-language-python-name-python3" title="Link to this heading">#</a></h2>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="balanced-cut">
<h1>Balanced cut<a class="headerlink" href="#balanced-cut" title="Link to this heading">#</a></h1>
<section id="ratio-cut">
<h2>Ratio Cut<a class="headerlink" href="#ratio-cut" title="Link to this heading">#</a></h2>
<p>Graph cut often provide unbalanced communities, e.g., a community consisting of a single node, and another consisting of all other nodes. For example, if the network has a node with degree one (e.g., one edge), an optimal cut will be to place this node in its own community, resulting in a cut of one.</p>
<p><strong>Ratio cut</strong> addresses this issue by introducing a normalization factor to balance the cut.
Suppose we cut the network into two communities <span class="math notranslate nohighlight">\(V_1\)</span> and <span class="math notranslate nohighlight">\(V_2\)</span>, then the ratio cut is defined as</p>
<div class="math notranslate nohighlight">
\[
\text{Ratio cut}(V_1, V_2) = \frac{1}{|V_1| \cdot |V_2|} \sum_{i \in V_1} \sum_{j \in V_2} A_{ij}
\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(|V_1|\)</span> (or |V_2|) is the number of nodes in the community <span class="math notranslate nohighlight">\(V_1\)</span> (or <span class="math notranslate nohighlight">\(V_2\)</span>).</p></li>
</ul>
<p>The normalization factor <span class="math notranslate nohighlight">\(1/(|V_1| |V_2|)\)</span> balances the community sizes. It’s smallest when communities are equal (<span class="math notranslate nohighlight">\(|V_1| = |V_2|\)</span>) and largest when one community has only one node (<span class="math notranslate nohighlight">\(|V_1| = 1\)</span> or <span class="math notranslate nohighlight">\(|V_2| = 1\)</span>).</p>
<div class="cell tag_hide-input docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Total number of nodes</span>
<span class="n">total_nodes</span> <span class="o">=</span> <span class="mi">100</span>

<span class="c1"># Create an array of possible sizes for V1</span>
<span class="n">V1_sizes</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="n">total_nodes</span><span class="p">)</span>

<span class="c1"># Calculate corresponding sizes for V2</span>
<span class="n">V2_sizes</span> <span class="o">=</span> <span class="n">total_nodes</span> <span class="o">-</span> <span class="n">V1_sizes</span>

<span class="c1"># Calculate the normalization factor</span>
<span class="n">normalization_factor</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="n">V1_sizes</span> <span class="o">*</span> <span class="n">V2_sizes</span><span class="p">)</span>

<span class="c1"># Create the plot</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">V1_sizes</span><span class="p">,</span> <span class="n">normalization_factor</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Normalization Factor vs. Community Size&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Size of V1&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;1 / (|V1| * |V2|)&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>  <span class="c1"># Use log scale for y-axis due to large range of values</span>
<span class="n">plt</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
<div class="cell_output docutils container">
<img alt="../_images/68c13033cd89f7fce564c7c79cbdf286e1bdf0b9c29f58ab3121eda22fd6d2d6.png" src="../_images/68c13033cd89f7fce564c7c79cbdf286e1bdf0b9c29f58ab3121eda22fd6d2d6.png" />
</div>
</div>
</section>
<section id="normalized-cut">
<h2>Normalized cut<a class="headerlink" href="#normalized-cut" title="Link to this heading">#</a></h2>
<p><strong>Normalized cut</strong><a class="footnote-reference brackets" href="#footcite-shi2000normalized" id="id20" role="doc-noteref"><span class="fn-bracket">[</span>15<span class="fn-bracket">]</span></a> balances communities based on edge count, unlike Ratio cut which uses node count. It is defined as:</p>
<div class="math notranslate nohighlight">
\[
\text{Normalized cut}(V_1, V_2) = \frac{1}{|E_1| \cdot |E_2|} \sum_{i \in V_1} \sum_{j \in V_2} A_{ij}
\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(|E_1|\)</span> and <span class="math notranslate nohighlight">\(|E_2|\)</span> are the number of edges in the communities <span class="math notranslate nohighlight">\(V_1\)</span> and <span class="math notranslate nohighlight">\(V_2\)</span>, respectively.</p></li>
</ul>
<div class="tip admonition">
<p class="admonition-title">Exercise</p>
<p>Compute the ratio cut and normalized cut for the following network. The red edges should be cut.</p>
<figure class="align-default" id="fig-graph-cut">
<img alt="../_images/414e4ea64165867af6293f722a45b9c55bcc7973a64f1a751097f60f618d6716.png" src="../_images/414e4ea64165867af6293f722a45b9c55bcc7973a64f1a751097f60f618d6716.png" />
</figure>
</div>
<details class="sd-sphinx-override sd-dropdown sd-card sd-mb-3">
<summary class="sd-summary-title sd-card-header">
Click here to reveal the answer<div class="sd-summary-down docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-down" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M5.22 8.72a.75.75 0 000 1.06l6.25 6.25a.75.75 0 001.06 0l6.25-6.25a.75.75 0 00-1.06-1.06L12 14.44 6.28 8.72a.75.75 0 00-1.06 0z"></path></svg></div>
<div class="sd-summary-up docutils">
<svg version="1.1" width="1.5em" height="1.5em" class="sd-octicon sd-octicon-chevron-up" viewBox="0 0 24 24" aria-hidden="true"><path fill-rule="evenodd" d="M18.78 15.28a.75.75 0 000-1.06l-6.25-6.25a.75.75 0 00-1.06 0l-6.25 6.25a.75.75 0 101.06 1.06L12 9.56l5.72 5.72a.75.75 0 001.06 0z"></path></svg></div>
</summary><div class="sd-summary-content sd-card-body docutils">
<p class="sd-card-text">The graph consists of two cliques, each with 5 nodes (<span class="math notranslate nohighlight">\(|V_1| = |V_2| = 5\)</span>).
Each clique has 10 internal edges and 2 edges connecting to the other clique.
Therefore, <span class="math notranslate nohighlight">\(|E_1| = |E_2| = 10 + 2 = 12\)</span>.
We can now calculate:</p>
<ul class="simple">
<li><p class="sd-card-text"><strong>Ratio cut</strong>: <span class="math notranslate nohighlight">\(2 / (5 \times 5) = 0.08\)</span>.</p></li>
<li><p class="sd-card-text"><strong>Normalized cut</strong>: <span class="math notranslate nohighlight">\(2 / (12 \times 12) = 0.01388889\)</span>.</p></li>
</ul>
</div>
</details><div class="cell tag_hide-input tag_remove-output docutils container">
<details class="hide above-input">
<summary aria-label="Toggle hidden content">
<span class="collapsed">Show code cell source</span>
<span class="expanded">Hide code cell source</span>
</summary>
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">igraph</span> <span class="k">as</span> <span class="nn">ig</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">myst_nb</span> <span class="kn">import</span> <span class="n">glue</span>

<span class="c1"># Create two cliques of size 5</span>
<span class="n">G1</span> <span class="o">=</span> <span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Full</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">G2</span> <span class="o">=</span> <span class="n">ig</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">Full</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Combine the two cliques</span>
<span class="n">G</span> <span class="o">=</span> <span class="n">G1</span> <span class="o">+</span> <span class="n">G2</span>

<span class="c1"># Add an edge between the two cliques</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">5</span><span class="p">)</span>
<span class="n">G</span><span class="o">.</span><span class="n">add_edge</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">6</span><span class="p">)</span>

<span class="c1"># Draw the graph</span>
<span class="n">layout</span> <span class="o">=</span> <span class="n">G</span><span class="o">.</span><span class="n">layout_fruchterman_reingold</span><span class="p">()</span>

<span class="c1"># Set up the plot</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">5</span><span class="p">))</span>

<span class="c1"># Draw the connecting edge in red</span>
<span class="n">ig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">G</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
    <span class="n">vertex_color</span><span class="o">=</span><span class="s1">&#39;lightblue&#39;</span><span class="p">,</span>
    <span class="n">vertex_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;gray&#39;</span><span class="p">,</span>
    <span class="n">edge_width</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Draw the connecting edge in red behind the graph</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">layout</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">layout</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">layout</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">layout</span><span class="p">[</span><span class="mi">5</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="n">layout</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="n">layout</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">0</span><span class="p">]],</span> <span class="p">[</span><span class="n">layout</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">],</span> <span class="n">layout</span><span class="p">[</span><span class="mi">6</span><span class="p">][</span><span class="mi">1</span><span class="p">]],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span> <span class="n">zorder</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>

<span class="n">ig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">G</span><span class="p">,</span>
    <span class="n">target</span><span class="o">=</span><span class="n">ax</span><span class="p">,</span>
    <span class="n">layout</span><span class="o">=</span><span class="n">layout</span><span class="p">,</span>
    <span class="n">vertex_color</span><span class="o">=</span><span class="s1">&#39;white&#39;</span><span class="p">,</span>
    <span class="n">vertex_size</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
    <span class="n">edge_color</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">,</span>
    <span class="n">edge_width</span><span class="o">=</span><span class="mi">1</span>
<span class="p">)</span>

<span class="c1"># Add labels to the nodes</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">coords</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">layout</span><span class="p">):</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">annotate</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="p">),</span> <span class="n">coords</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s1">&#39;center&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Two Cliques Connected by One Edge&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axis</span><span class="p">(</span><span class="s1">&#39;off&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>

<span class="n">glue</span><span class="p">(</span><span class="s2">&quot;fig-graph-cut&quot;</span><span class="p">,</span> <span class="n">fig</span><span class="p">,</span> <span class="n">display</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</details>
</div>
</section>
<section id="cut-into-more-than-two-communities">
<h2>Cut into more than two communities<a class="headerlink" href="#cut-into-more-than-two-communities" title="Link to this heading">#</a></h2>
<p>Ratio cut and Normalized cut can be extended to cut into more than two communities. Specifically, we can extend them to cut into <span class="math notranslate nohighlight">\(k\)</span> communities, i.e., <span class="math notranslate nohighlight">\(V_1, V_2, \dots, V_k\)</span> by defining</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{align}
\text{Ratio cut}(V_1, V_2, \dots, V_k) &amp;= \sum_{k=1}^K \frac{1}{|V_k|} \left(\sum_{i \in V_k} \sum_{j \notin V_{k}} A_{ij} \right) \\
\text{Normalized cut}(V_1, V_2, \dots, V_k) &amp;= \sum_{k=1}^K \frac{1}{|E_k|} \left(\sum_{i \in V_k} \sum_{j \notin V_{k}} A_{ij} \right)
\end{align}
\end{split}\]</div>
</section>
<section id="algorithms-to-find-the-best-cut">
<h2>Algorithms to find the best cut<a class="headerlink" href="#algorithms-to-find-the-best-cut" title="Link to this heading">#</a></h2>
<p>For both ratio and normalized cut, finding the best cut is a NP-hard problem. Yet, there are some heuristics to find a good cut.
Interested students are encouraged to refer to <a class="reference external" href="https://arxiv.org/abs/0711.0189">Ulrike von Luxburg “A Tutorial on Spectral Clustering”</a> for more details.</p>
</section>
<section id="issue-of-ratio-cut-and-normalized-cut">
<h2>Issue of Ratio cut and Normalized cut<a class="headerlink" href="#issue-of-ratio-cut-and-normalized-cut" title="Link to this heading">#</a></h2>
<p>While Ratio cut and Normalized cut methods are clever approaches, they do come with a couple of challenges we should be aware of.</p>
<p>Firstly, these methods ask us to decide upfront how many communities we want to find. This can be tricky because, in real-world networks, we often don’t know this number in advance. It requires us to make a guess on how many different groups of friends we have before actually looking at our social circle.</p>
<p>Secondly, and perhaps more critically, these methods <em>favor</em> communities of roughly the same size.
It’s as if they’re assuming all our friend groups should have about the same number of people.
But as we know from real life, that’s not always the case.
Some of us might have a large group of college friends and a smaller group of childhood buddies.
Research has shown that in many real-world networks, communities can indeed be quite different in size <a class="footnote-reference brackets" href="#footcite-palla2005uncovering" id="id21" role="doc-noteref"><span class="fn-bracket">[</span>16<span class="fn-bracket">]</span></a><a class="footnote-reference brackets" href="#footcite-clauset2004finding" id="id22" role="doc-noteref"><span class="fn-bracket">[</span>17<span class="fn-bracket">]</span></a>.</p>
<p>These limitations don’t mean these methods should not be used, but they do remind us the importance of understanding the underlying assumptions and limitations of methods we use 😉.
It’s always good to keep these points in mind when we’re working with network data. 🕸️💡</p>
<div class="docutils container" id="id23">
<aside class="footnote-list brackets">
<aside class="footnote brackets" id="footcite-shi2000normalized" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id20">15</a><span class="fn-bracket">]</span></span>
<p>Jianbo Shi and Jitendra Malik. Normalized cuts and image segmentation. <em>IEEE Transactions on pattern analysis and machine intelligence</em>, 22(8):888–905, 2000.</p>
</aside>
<aside class="footnote brackets" id="footcite-palla2005uncovering" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id21">16</a><span class="fn-bracket">]</span></span>
<p>Gergely Palla, Imre Derényi, Illés Farkas, and Tamás Vicsek. Uncovering the overlapping community structure of complex networks in nature and society. <em>nature</em>, 435(7043):814–818, 2005.</p>
</aside>
<aside class="footnote brackets" id="footcite-clauset2004finding" role="doc-footnote">
<span class="label"><span class="fn-bracket">[</span><a role="doc-backlink" href="#id22">17</a><span class="fn-bracket">]</span></span>
<p>Aaron Clauset, Mark EJ Newman, and Cristopher Moore. Finding community structure in very large networks. <em>Physical Review E—Statistical, Nonlinear, and Soft Matter Physics</em>, 70(6):066111, 2004.</p>
</aside>
</aside>
</div>
</section>
<section id="characterizing-network-structures-with-the-sbm">
<h2>Characterizing network structures with the SBM<a class="headerlink" href="#characterizing-network-structures-with-the-sbm" title="Link to this heading">#</a></h2>
<p>Stochastic Block Model is a flexible model that can be used to describe a wide range of network structures.</p>
<p>Let’s start with communities where nodes within a community are more likely to be connected to each other than nodes in different communities. We can describe this using SBM by:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
P_{c,c'} = \begin{cases}
    p_{\text{in}} &amp; \text{if } c = c' \\
    p_{\text{out}} &amp; \text{if } c \neq c'
\end{cases}
\end{split}\]</div>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(p_{\text{in}}\)</span> is the chance of a connection between nodes in the same community</p></li>
<li><p><span class="math notranslate nohighlight">\(p_{\text{out}}\)</span> is the chance of a connection between nodes in different communities</p></li>
</ul>
<p>Usually, we set <span class="math notranslate nohighlight">\(p_{\text{in}} &gt; p_{\text{out}}\)</span>, because nodes in the same community tend to be more connected.</p>
<p>But, there’s more SBM can do:</p>
<ol class="arabic simple">
<li><p><strong>Disassortative communities</strong>: What if we flip things around and set <span class="math notranslate nohighlight">\(p_{\text{in}} &lt; p_{\text{out}}\)</span>? Now we have communities where nodes prefer to connect with nodes from other communities. This is not in line with the communities we have focused on so far. Yet, it is still a valid model of community structure, and SBM allows for this generalization of community structure easily.</p></li>
<li><p><strong>Random networks</strong>: If we make <span class="math notranslate nohighlight">\(p_{\text{in}} = p_{\text{out}}\)</span>, we get a completely random network where every node has an equal chance of connecting to any other node. This is what we call an Erdős-Rényi network.</p></li>
</ol>
<p>In sum, SBM has been used as a playground for network scientists. We can use it to create many interesting network structures and study how they behave.</p>
</section>
<section id="generating-networks-with-sbm">
<h2>Generating networks with SBM<a class="headerlink" href="#generating-networks-with-sbm" title="Link to this heading">#</a></h2>
<p>It is easy to generate networks with SBM using igraph.
For example, the assortativity communities can be generated as follows.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">igraph</span>

<span class="n">p_in</span> <span class="o">=</span> <span class="mf">0.1</span>
<span class="n">p_out</span> <span class="o">=</span> <span class="mf">0.001</span>
<span class="n">block_sizes</span> <span class="o">=</span> <span class="p">[</span><span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">,</span> <span class="mi">300</span><span class="p">]</span>
<span class="n">n</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">)</span>

<span class="n">pref_matrix</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">[</span><span class="n">p_in</span><span class="p">,</span> <span class="n">p_out</span><span class="p">,</span> <span class="n">p_out</span><span class="p">],</span>
    <span class="p">[</span><span class="n">p_out</span><span class="p">,</span> <span class="n">p_in</span><span class="p">,</span> <span class="n">p_out</span><span class="p">],</span>
    <span class="p">[</span><span class="n">p_out</span><span class="p">,</span> <span class="n">p_out</span><span class="p">,</span> <span class="n">p_in</span><span class="p">]</span>
<span class="p">]</span>

<span class="n">g</span> <span class="o">=</span> <span class="n">igraph</span><span class="o">.</span><span class="n">Graph</span><span class="o">.</span><span class="n">SBM</span><span class="p">(</span><span class="n">n</span><span class="p">,</span> <span class="n">pref_matrix</span><span class="p">,</span> <span class="n">block_sizes</span><span class="p">)</span>

<span class="c1"># Plot the network</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="n">palette</span> <span class="o">=</span> <span class="n">sns</span><span class="o">.</span><span class="n">color_palette</span><span class="p">()</span>

<span class="n">community_colors</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">([[</span><span class="n">palette</span><span class="p">[</span><span class="n">i</span><span class="p">]]</span> <span class="o">*</span> <span class="n">block_sizes</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">block_sizes</span><span class="p">))],</span> <span class="p">[])</span>
<span class="n">igraph</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">g</span><span class="p">,</span> <span class="n">vertex_color</span><span class="o">=</span><span class="n">community_colors</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/c1a1fc6f55355e3388f597908597f45b81a29422ddd07f76fbaf244bf894e964.svg" src="../_images/c1a1fc6f55355e3388f597908597f45b81a29422ddd07f76fbaf244bf894e964.svg" /></div>
</div>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pref_matrix</span></code> is the matrix of connection probabilities between communities. Its <span class="math notranslate nohighlight">\((i,j)\)</span>th-element is the probability of a connection between nodes in community <span class="math notranslate nohighlight">\(i\)</span> and <span class="math notranslate nohighlight">\(j\)</span>.</p></li>
</ul>
</section>
<section id="detecting-communities-with-sbm">
<h2>Detecting communities with SBM<a class="headerlink" href="#detecting-communities-with-sbm" title="Link to this heading">#</a></h2>
<p>Imagine you’re a detective trying to figure out how a network was created. You have a hunch about the community structure, and you want to know if it matches the network you see. That’s exactly what we’re going to do to find out communities!</p>
<p>Here’s how we can describe the probability of seeing a particular network, given a community structure:</p>
<div class="math notranslate nohighlight">
\[
P(\left\{A_{ij}\right\}_{ij}) = \prod_{i&lt;j} P(A_{ij}=1|c_i, c_j)^{A_{ij}} (1-P(A_{ij}=1|c_i, c_j))^{1-A_{ij}}
\]</div>
<p>Let’s break this down into simpler terms:</p>
<ul class="simple">
<li><p>First, <span class="math notranslate nohighlight">\(\left\{A_{ij}\right\}_{ij}\)</span> is just a fancy way of saying “all the connections in our network”. Think of it as a big table showing who’s connected to whom.</p></li>
<li><p>We use <span class="math notranslate nohighlight">\(\prod_{i &lt; j}\)</span> instead of <span class="math notranslate nohighlight">\(\prod_{i,j}\)</span> because we’re dealing with an undirected network. This means if Alice is friends with Bob, Bob is also friends with Alice. We only need to count this friendship once, not twice!</p></li>
<li><p>The last part, <span class="math notranslate nohighlight">\(P(A_{ij}=1|c_i, c_j)^A_{ij}(1-P(A_{ij}=1|c_i, c_j))^{1-A_{ij}}\)</span>, might look scary, but it’s actually quite clever. It’s a shorthand way of saying “what’s the chance of this connection existing or not existing?” If the connection exists (<span class="math notranslate nohighlight">\(A_{ij}=1\)</span>), we use the first part. If it doesn’t (<span class="math notranslate nohighlight">\(A_{ij}=0\)</span>), we use the second part. It’s a two-in-one formula.</p></li>
</ul>
<p>Here’s a neat trick we can use to make our lives easier. We can take the logarithm of both sides of our equation. This turns our big product (multiplication) into a simpler sum (addition).</p>
<div class="math notranslate nohighlight">
\[
{\cal L}=\log P(\left\{A_{ij}\right\}_{ij}) = \sum_{i&lt;j} A_{ij} \log P(A_{ij}=1|c_i, c_j) + (1-A_{ij}) \log (1-P(A_{ij}=1|c_i, c_j))
\]</div>
<p>We call this the <strong>likelihood function</strong>. It tells us how likely we are to see this network given our community guess. We can play around with different community assignments and edge probabilities to see which one gives us the highest likelihood.
To make this game easier, let’s first figure out the best edge probabilities for a given community assignment.</p>
<p>Our likelihood function has a special shape - it is <em>a concave function</em> with respect to <span class="math notranslate nohighlight">\(p_{c,c'}\)</span>. This means that the likelihood function is a hill with only one peak when we look at it in terms of edge probability <span class="math notranslate nohighlight">\(p_{c,c'}\)</span>.</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/511d414dadc8290418635afa533a861626ba9589145fa87155b6f6585624200b.png" src="../_images/511d414dadc8290418635afa533a861626ba9589145fa87155b6f6585624200b.png" />
</div>
</div>
<p>So, what does this mean for us? The top of this hill (our maximum value) is flat, and there’s only one flat spot on the whole hill. So if we can find a spot where the hill isn’t sloping at all (that’s what we mean by “zero gradient”), we’ve found the very top of the hill! 🏔️</p>
<p>In math terms, we take the derivative of our likelihood function with respect to <span class="math notranslate nohighlight">\(p_{c,c'}\)</span> and set it to zero, i.e., <span class="math notranslate nohighlight">\(\partial {\cal L}  / \partial p_{cc'} = 0\)</span>. Here is what we get:</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\begin{aligned}
\frac{\partial {\cal L}}{\partial p_{c,c'}} &amp;= 0 \\
\Rightarrow &amp; \sum_{i&lt;j} \left[A_{ij} \frac{1}{p_{c_i,c_j}} \delta(c_i,c)\delta(c_j,c') -(1-A_{ij}) \frac{1}{1-p_{c_i,c_j}}\delta(c_i,c')\delta(c_j,c') \right] = 0 \\
\Rightarrow &amp;
\frac{m_{cc'}}{p_{c_i,c_j}} - \frac{\sum_{i &lt; j} \delta(c_i,c)\delta(c_j,c') }{1-p_{c_i,c_j}} = 0 &amp; \text{if } c \neq  c' \\
\Rightarrow &amp; p_{c,c'} = \frac{m_{cc'}}{\sum_{i &lt; j} \delta(c_i,c)\delta(c_j,c')}
\end{aligned}
\end{split}\]</div>
<p>Let’s break down these equations:</p>
<ul class="simple">
<li><p><span class="math notranslate nohighlight">\(m_{cc'}\)</span> is the number of edges between nodes in community <span class="math notranslate nohighlight">\(c\)</span> and those in community <span class="math notranslate nohighlight">\(c'\)</span>.</p></li>
<li><p>The derivative <span class="math notranslate nohighlight">\(\partial \log p_{cc} / \partial p_{cc}\)</span> is just <span class="math notranslate nohighlight">\(1/p_{cc}\)</span>.</p></li>
</ul>
<p>The denominator <span class="math notranslate nohighlight">\(\sum_{i &lt; j} \delta(c_i,c)\delta(c_j,c')\)</span> is the total number of pairs of nodes that belong to communities <span class="math notranslate nohighlight">\(c\)</span> and <span class="math notranslate nohighlight">\(c'\)</span>. It is given by</p>
<div class="math notranslate nohighlight">
\[\begin{split}
\sum_{i &lt; j} \delta(c_i,c)\delta(c_j,c') =
\begin{cases}
n_cn_{c'} &amp; \text{if } c \neq c' \\
\frac{n_c (n_c - 1)}{2} &amp; \text{if } c = c'
\end{cases}
\end{split}\]</div>
<p>Why do we have two different equations for <span class="math notranslate nohighlight">\(p_{c,c'}\)</span>? It’s because we are counting each pair of nodes only by once. It is easy to verify when looking at the adjacency matrix:</p>
<div class="cell tag_remove-input docutils container">
<div class="cell_output docutils container">
<img alt="../_images/08a3603ba540b1550f86c090011e2e49eedc32d9da5619b7ef833ea53ede058f.png" src="../_images/08a3603ba540b1550f86c090011e2e49eedc32d9da5619b7ef833ea53ede058f.png" />
</div>
</div>
<p>The upper triangle of the adjacency matrix represents <span class="math notranslate nohighlight">\(i &lt; j\)</span> over which we take the sum.
When <span class="math notranslate nohighlight">\(c=c'\)</span> (the diagonal block), we count only the upper half of the block, resulting in <span class="math notranslate nohighlight">\(\frac{n_c (n_c - 1)}{2}\)</span>. When <span class="math notranslate nohighlight">\(c \neq c'\)</span> (different communities), we count all connections between them, resulting in <span class="math notranslate nohighlight">\(n_cn_{c'}\)</span>.</p>
<p>We have now obtaind the likelihood function based only on the community assignment. Maximizing <span class="math notranslate nohighlight">\({\cal L}\)</span> with respect to the community assignment gives us the most likely community assignment for the network.</p>
</section>
</section>
<section class="tex2jax_ignore mathjax_ignore" id="module-5-clustering">
<h1>Module 5: Clustering<a class="headerlink" href="#module-5-clustering" title="Link to this heading">#</a></h1>
<section id="what-to-learn-in-this-module">
<h2>What to learn in this module<a class="headerlink" href="#what-to-learn-in-this-module" title="Link to this heading">#</a></h2>
<p>In this module, we will learn community detection, one of the most widely-used yet controversial techniques in network analysis. We will learn:</p>
<ul class="simple">
<li><p>What is community structure in networks?</p></li>
<li><p>How to operationalize community structure?</p></li>
<li><p>How to find communities in networks?</p></li>
<li><p>Limitations of community detection</p></li>
<li><p><strong>Keywords</strong>: community detection, assortativity, modularity, resolution limit, rugged landscape, random graph, label switching algorithm, Louvain algorithm, stochastic block model, the configuration model.</p></li>
</ul>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "skojaku/adv-net-sci",
            ref: "gh-pages",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./tmp"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <div class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="visible nav section-nav flex-column">
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#">Hands-on: Clustering</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modularity-maximization">Modularity maximization</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-01">Exercise 01 🏋️‍♀️💪🧠</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#stochstic-block-model">Stochstic Block Model</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#exercise-02">Exercise 02 🏋️‍♀️💪🧠</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#modularity-demo">Modularity Demo</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#limitation-of-modularity">Limitation of Modularity</a><ul class="nav section-nav flex-column">
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#resolution-limit">Resolution limit</a></li>
<li class="toc-h3 nav-item toc-entry"><a class="reference internal nav-link" href="#spurious-communities">Spurious communities</a></li>
</ul>
</li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#so-should-we-avoid-modularity">So should we avoid modularity?</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#the-full-modularity-formula-is-on-the-next-page-jupytext-formats-md-myst-text-representation-extension-md-format-name-myst-kernelspec-display-name-python-3-language-python-name-python3">The full modularity formula is on the next page 😉.—
jupytext:
formats: md:myst
text_representation:
extension: .md
format_name: myst
kernelspec:
display_name: Python 3
language: python
name: python3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#community-detection-pattern-matching">Community detection (pattern matching)</a></li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#pen-and-paper">Pen and Paper</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#pen-and-paper-exercise">✍️ <span class="xref myst">Pen and Paper Exercise</span> 🚢</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#jupytext-formats-md-myst-text-representation-extension-md-format-name-myst-kernelspec-display-name-python-3-language-python-name-python3">jupytext:
formats: md:myst
text_representation:
extension: .md
format_name: myst
kernelspec:
display_name: Python 3
language: python
name: python3</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#balanced-cut">Balanced cut</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#ratio-cut">Ratio Cut</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#normalized-cut">Normalized cut</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#cut-into-more-than-two-communities">Cut into more than two communities</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#algorithms-to-find-the-best-cut">Algorithms to find the best cut</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#issue-of-ratio-cut-and-normalized-cut">Issue of Ratio cut and Normalized cut</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#characterizing-network-structures-with-the-sbm">Characterizing network structures with the SBM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#generating-networks-with-sbm">Generating networks with SBM</a></li>
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#detecting-communities-with-sbm">Detecting communities with SBM</a></li>
</ul>
</li>
<li class="toc-h1 nav-item toc-entry"><a class="reference internal nav-link" href="#module-5-clustering">Module 5: Clustering</a><ul class="visible nav section-nav flex-column">
<li class="toc-h2 nav-item toc-entry"><a class="reference internal nav-link" href="#what-to-learn-in-this-module">What to learn in this module</a></li>
</ul>
</li>
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By Sadamori Kojaku
</p>

  </div>
  
  <div class="footer-item">
    

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/bootstrap.js?digest=dfe6caa3a7d634c4db9b"></script>
<script src="../_static/scripts/pydata-sphinx-theme.js?digest=dfe6caa3a7d634c4db9b"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>